{% load static %} <!-- Load the static template tag library -->
<!DOCTYPE html> 
<html>
<head>
    <title>it's giving</title>
    <script>
        document.addEventListener('DOMContentLoaded', function() { // Wait for the DOM hierarchy of HTML objects to load in the browser
            const form = document.getElementById('text-form'); // Get the form element by its ID (we've defined below)
            const textarea = document.getElementById('id_text'); // Get the textarea element by its ID (automatically generated by Django id_fieldname)
            const imageContainer = document.getElementById('image-container'); // Get the image container element by its ID (we've defined below)
        
            textarea.addEventListener('input', function() { // Listen for input events on the textarea element
                const formData = new FormData(form); // Create a new FormData object from the form element (used to send form data in AJAX request but behaves like usual POST request for Djano backend)
                fetch('', {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest', // Add this header to identify the request as AJAX in Django
                        'X-CSRFToken': formData.get('csrfmiddlewaretoken') // Add the CSRF token to the request headers for security
                    }
                })
                .then(response => response.json()) // Parse the response as JSON
                .then(data => { // Rename JSON response to data and change/remove the image in the container
                    if (data.image_path) {
                        imageContainer.innerHTML = `<img src="${data.image_path}">`;
                    } else {
                        imageContainer.innerHTML = ''; // Clear the container if no image_path
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    imageContainer.innerHTML = ''; // Clear the container on error
                });
            });
        });
    </script>
</head>
<body>
    <form id="text-form" method="post"> <!-- Define the form element with an ID and POST method -->
        {% csrf_token %} <!-- Add the CSRF token to the form for security -->
        {{ form.as_p }} <!-- Render the form fields as paragraphs -->
    </form>
    <h1 >...it's giving</h1> 
    <div id="image-container">
        {% if image_path %} <!-- Check if image_path exists (backup in case AJAX JS imageContainer.innerHTML rewriting fails) -->
            <img src="{% static image_path %}">
        {% endif %}
    </div>
</body>
</html>